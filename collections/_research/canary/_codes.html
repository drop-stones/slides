
{% assign thread1 = '
// Thread 1
int main() {
  int **x = malloc(); // alloc_x
  int *a  = malloc(); // alloc_a
  *x = a;             // alloc_x -> a
  create_thread(thread2, x);

  if(cond) {
    int *c = *x; // c -> {a, b}
    print(*c);   // May-use alloc_b...?
  }
}
'%}

{% assign thread2 = '
// Thread 2
void thread2(int **y) {
  int *b = malloc(); // alloc_b

  if (!cond) {
    *y = b;          // alloc_x -> b
    free(b);         // free alloc_b
  }
}
'%}

{% assign concurrency_bugs ='
// Thread 1 (src)   // Thread 2 (sink)

// use-after-free
free(x);
                    use(x);

// race condition
                    if (i < N)
i++;
                    return arr[i];

// data race
x++;                x++;
'%}